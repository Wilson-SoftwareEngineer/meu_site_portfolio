{% load static %}
<!DOCTYPE html>
<html class="dark" lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>{{ config.titulo_site|default:"Piauí Tech Hub" }}</title>
    
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
    
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#0d59f2",
              "background-light": "#f5f6f8",
              "background-dark": "#101622",
            },
            fontFamily: { "display": ["Space Grotesk", "sans-serif"] },
          },
        },
      }
    </script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
    
    <button id="chat-toggle" class="fixed bottom-6 right-6 bg-primary text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition-all z-50 flex items-center justify-center w-14 h-14 cursor-pointer">
        <span class="material-symbols-outlined text-2xl">chat</span>
    </button>

    <div id="chat-window" class="fixed bottom-24 right-6 w-80 bg-[#1a2336] rounded-xl shadow-2xl border border-white/10 z-50 hidden flex flex-col overflow-hidden">
        <div class="bg-primary p-4 flex justify-between items-center">
            <h3 class="text-white font-bold">Assistente Tech</h3>
            <button id="chat-close" class="text-white hover:text-gray-200 cursor-pointer">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div id="chat-messages" class="h-80 p-4 overflow-y-auto bg-[#101622] flex flex-col gap-3">
            <div class="self-start bg-[#1a2336] text-gray-200 p-3 rounded-lg rounded-tl-none border border-white/5 text-sm max-w-[80%]">
                Olá! Sou a IA do Piauí Tech Hub. Represento o Wilson. Posso ajuda-lo?
            </div>
        </div>
        <div class="p-3 bg-[#1a2336] border-t border-white/10 flex gap-2">
            <input id="user-input" type="text" placeholder="Digite sua dúvida..." class="w-full bg-[#101622] text-white text-sm rounded-lg px-3 py-2 border border-white/10 focus:outline-none focus:border-primary" onkeydown="if(event.key === 'Enter') sendMessage()">
            <button id="send-btn" onclick="sendMessage()" class="text-primary hover:text-white p-2 transition-colors cursor-pointer">
                <span class="material-symbols-outlined">send</span>
            </button>
        </div>
    </div>

    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        <div class="layout-container flex h-full grow flex-col">
            <div class="flex flex-1 justify-center py-5">
                <div class="layout-content-container flex w-full flex-col max-w-[1100px] px-4">
                    
                    <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-white/10 px-4 sm:px-10 py-3 sticky top-0 z-50 bg-background-dark/80 backdrop-blur-sm">
                        <div class="flex items-center gap-3 text-white">
                            <img src="{% static 'imagens/logopitech.png' %}" alt="Logo" class="h-8 w-auto"> 
                            <h2 class="text-white text-lg font-bold leading-tight">Piauí Tech Hub</h2>
                        </div>

                        <nav class="hidden lg:flex flex-1 justify-end gap-8">
                            <div class="flex items-center gap-9">
                                <a class="text-white text-sm font-medium hover:text-primary transition-colors" href="{% url 'home' %}">Home</a>
                                <a class="text-white text-sm font-medium hover:text-primary transition-colors" href="{% url 'engenharia_software' %}">Engenharia de Software</a>
                                
                                <div class="relative group">
                                    <a class="text-white text-sm font-medium flex items-center gap-1 cursor-pointer hover:text-primary transition-colors" href="#">
                                        <span>Hub de Conhecimento</span>
                                        <span class="material-symbols-outlined text-base transition-transform group-hover:rotate-180">expand_more</span>
                                    </a>
                                    <div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-[#1a2336] border border-white/10 rounded-lg shadow-lg p-2 hidden group-hover:flex flex-col gap-1">
                                        <a class="block px-3 py-2 text-sm text-white/80 hover:bg-primary/30 hover:text-white rounded" href="{% url 'posts_por_categoria' 'TUT' %}">Tutoriais</a>
                                        <a class="block px-3 py-2 text-sm text-white/80 hover:bg-primary/30 hover:text-white rounded" href="{% url 'posts_por_categoria' 'GUIA' %}">Guias Completos</a>
                                        <a class="block px-3 py-2 text-sm text-white/80 hover:bg-primary/30 hover:text-white rounded" href="{% url 'posts_por_categoria' 'TOOL' %}">Ferramentas</a>
                                    </div>
                                </div>

                                <a class="text-white text-sm font-medium hover:text-primary transition-colors" href="{% url 'posts_por_categoria' 'NEWS' %}">Atualidades Tech</a>
                                <a class="text-white text-sm font-medium hover:text-primary transition-colors" href="#hall-da-fama">Hall da Fama</a>
                            </div>
                        </nav>
                        <button class="lg:hidden text-white"><span class="material-symbols-outlined">menu</span></button>
                    </header>

                    <main class="flex-grow">
                        <section class="my-10 @container">
                            <div class="@[480px]:p-4">
                                <div class="flex min-h-[480px] flex-col gap-6 bg-cover bg-center bg-no-repeat rounded-xl items-center justify-center p-4" 
                                     style='background-image: linear-gradient(rgba(16, 22, 34, 0.7) 0%, rgba(16, 22, 34, 0.9) 100%), url("https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=2070&auto=format&fit=crop");'>
                                    <div class="flex flex-col gap-2 text-center max-w-2xl">
                                        <h1 class="text-white text-4xl font-black leading-tight">Em sintonia com a evolução tecnológica</h1>
                                        <h2 class="text-gray-300 text-sm font-normal">Seu hub de conhecimento em Engenharia de Software e Tecnologia.</h2>
                                    </div>
                                    <button onclick="document.getElementById('ultimas-publicacoes').scrollIntoView({behavior: 'smooth'})" 
                                            class="flex min-w-[84px] cursor-pointer items-center justify-center rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold hover:bg-blue-600 transition-colors">
                                        <span class="truncate">Explore o Hub</span>
                                    </button>
                                </div>
                            </div>
                        </section>

                        <section id="ultimas-publicacoes" class="my-10">
                            <h2 class="text-white text-3xl font-bold px-4 pb-3 pt-5 border-b-2 border-primary/50 inline-block">Últimas Publicações</h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-4 mt-4">
                                {% for post in posts %}
                                <div class="flex flex-col gap-3 pb-3 bg-[#1a2336] rounded-xl overflow-hidden group border border-transparent hover:border-primary/50 transition-all">
                                    <div class="w-full bg-center bg-no-repeat aspect-video bg-cover" style='background-image: url("{{ post.imagem.url }}");'></div>
                                    <div class="p-4 flex flex-col flex-grow">
                                        <p class="text-primary text-xs font-bold uppercase tracking-wider mb-2">{{ post.get_categoria_display }}</p>
                                        <p class="text-white text-xl font-medium">{{ post.titulo }}</p>
                                        <p class="text-[#90a4cb] text-sm mt-2 flex-grow">{{ post.subtitulo }}</p>
                                        <a class="text-primary text-sm font-bold mt-4 inline-flex items-center gap-2 group-hover:gap-3 transition-all" href="{% url 'post_detail' post.id %}">
                                           Leia Mais <span class="material-symbols-outlined">arrow_forward</span>
                                        </a>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-gray-400 p-4">Nenhuma publicação cadastrada ainda.</p>
                                {% endfor %}
                            </div>
                            
                            <div class="flex px-4 py-8 justify-center">
                                <a href="{% url 'posts_por_categoria' 'NEWS' %}" class="flex items-center justify-center rounded-lg h-10 px-4 bg-[#222f49] text-white text-sm font-bold hover:bg-[#2e3f61] transition-colors">
                                    Ver todos os artigos
                                </a>
                            </div>
                        </section>

                        <section class="my-16 px-4 sm:px-10" id="sobre-mim">
                            <div class="bg-[#1a2336] rounded-2xl p-8 md:p-12 border border-white/5 overflow-hidden relative">
                                <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-primary/10 rounded-full blur-3xl"></div>
                                <div class="grid md:grid-cols-2 gap-12 items-center relative z-10">
                                    <div class="order-2 md:order-1 flex justify-center md:justify-start">
                                        <div class="relative group">
                                            <div class="absolute -inset-1 bg-gradient-to-r from-primary to-blue-400 rounded-xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                                            {% if perfil.foto %}
                                            <img src="{{ perfil.foto.url }}" alt="{{ perfil.nome_completo }}" class="relative w-full max-w-sm rounded-xl shadow-2xl border border-white/10 object-cover transform transition-transform duration-500 group-hover:scale-[1.01]">
                                            {% else %}
                                            <div class="w-64 h-64 bg-gray-700 flex items-center justify-center text-white">Sem Foto</div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="order-1 md:order-2 flex flex-col gap-6 text-left">
                                        <div>
                                            <h2 class="text-primary text-sm font-bold uppercase tracking-wider mb-2">Portfolio</h2>
                                            <h3 class="text-white text-3xl md:text-4xl font-bold leading-tight">{{ perfil.nome_completo }}</h3>
                                            <p class="text-gray-400 text-sm mt-1">{{ perfil.titulo_profissional }}</p>
                                            <div class="w-24 h-1.5 bg-primary rounded-full mt-4"></div>
                                        </div>

                                        <div class="space-y-4 text-gray-300 text-lg leading-relaxed text-justify">
                                            <p>{{ perfil.resumo }}</p>
                                            <p>{{ perfil.biografia_completa|linebreaks }}</p>
                                        </div>

                                        <div class="pt-4">
                                            {% if perfil.linkedin %}
                                            <a href="{{ perfil.linkedin }}" target="_blank" class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-primary hover:bg-blue-600 text-white font-bold rounded-lg transition-colors group">
                                            Entrar em contato <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform">open_in_new</span>
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="my-16 px-4" id="hall-da-fama">
                            <div class="text-center mb-12">
                                <h2 class="text-white text-3xl font-bold leading-tight pb-3 border-b-2 border-primary inline-block">Hall da Fama da Computação</h2>
                                <p class="text-gray-400 mt-4 max-w-2xl mx-auto">Conheça os visionários que transformaram o mundo.</p>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                {% for membro in membros %}
                                <div class="bg-[#1a2336] rounded-xl p-6 flex flex-col items-center text-center border border-transparent hover:border-primary/50 transition-all group hover:-translate-y-1 duration-300">
                                    <div class="w-32 h-32 mb-4 rounded-full overflow-hidden border-4 border-primary/20 group-hover:border-primary transition-colors flex-shrink-0">
                                    {% if membro.imagem %}
                                        <img src="{{ membro.imagem.url }}" alt="{{ membro.nome }}" class="w-full h-full object-cover object-center">
                                    {% else %}
                                        <div class="w-full h-full bg-gray-700 flex items-center justify-center text-white text-xs">Sem Foto</div>
                                    {% endif %}
                                    </div>
                                    <h3 class="text-xl font-bold text-white mt-2">{{ membro.nome }}</h3>
                                    <span class="text-primary text-xs font-bold uppercase tracking-wider mb-3 block">{{ membro.titulo }}</span>
                                    <p class="text-gray-400 text-sm leading-relaxed text-justify h-48 overflow-y-auto pr-2 custom-scrollbar">{{ membro.descricao }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </section>
                    </main>

                    <footer class="mt-10 border-t border-solid border-white/10 px-4 sm:px-10 py-8">
                        <div class="grid md:grid-cols-3 gap-8">
                            <div>
                                <div class="flex items-center gap-3">
                                    <img src="{% static 'imagens/logopitech.png' %}" alt="Logo" class="h-6 w-auto">
                                    <h2 class="text-white text-lg font-bold">Piauí Tech Hub</h2>
                                </div>
                                <p class="text-gray-400 text-sm mt-2">Aqui os desenvolvedores se sentem em casa</p>
                            </div>
                            
                            <div>
                                <h3 class="text-white font-semibold mb-3">Mapa do Site</h3>
                                <ul class="space-y-2">
                                    <li><a class="text-gray-400 hover:text-primary text-sm transition-colors" href="{% url 'home' %}">Home</a></li>
                                    <li><a class="text-gray-400 hover:text-primary text-sm transition-colors" href="{% url 'engenharia_software' %}">Engenharia de Software</a></li>
                                    <li><a class="text-gray-400 hover:text-primary text-sm transition-colors" href="{% url 'posts_por_categoria' 'TUT' %}">Tutoriais</a></li>
                                    <li><a class="text-gray-400 hover:text-primary text-sm transition-colors" href="{% url 'posts_por_categoria' 'TOOL' %}">Ferramentas</a></li>
                                </ul>
                            </div>
                            
                            <div>
                                <h3 class="text-white font-semibold mb-3">Siga-nos</h3>
                                <div class="flex items-center gap-4">
                                    <span class="text-gray-500 text-sm">Links em breve...</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 pt-8 border-t border-solid border-white/10 text-center">
                            <p class="text-gray-500 text-sm">© 2026 Piauí Tech Hub. Todos os direitos reservados.</p>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');
        const chatClose = document.getElementById('chat-close');
        const messagesContainer = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        function toggleChat() {
            chatWindow.classList.toggle('hidden');
            if (!chatWindow.classList.contains('hidden')) {
                setTimeout(() => userInput.focus(), 100);
            }
        }

        chatToggle.addEventListener('click', toggleChat);
        chatClose.addEventListener('click', toggleChat);

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;
            addMessage(text, 'user');
            userInput.value = '';
            sendBtn.disabled = true;
            const loadingId = addMessage('...', 'ai', true);

            try {
                const response = await fetch('/api/chat/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ message: text })
                });

                if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                const data = await response.json();
                removeMessage(loadingId);
                addMessage(data.reply, 'ai');

            } catch (error) {
                console.error("Erro no envio:", error);
                removeMessage(loadingId);
                addMessage('Erro ao conectar. Tente mais tarde.', 'ai');
            }
            sendBtn.disabled = false;
            userInput.focus();
        }

        function addMessage(text, sender, isLoading = false) {
            const div = document.createElement('div');
            div.id = Date.now();
            if (sender === 'user') {
                div.className = "self-end bg-primary text-white p-3 rounded-lg rounded-tr-none text-sm max-w-[80%]";
            } else {
                div.className = "self-start bg-[#1a2336] text-gray-200 p-3 rounded-lg rounded-tl-none border border-white/5 text-sm max-w-[80%]";
                if (isLoading) div.classList.add('animate-pulse');
            }
            div.innerText = text;
            messagesContainer.appendChild(div);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return div.id;
        }

        function removeMessage(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>